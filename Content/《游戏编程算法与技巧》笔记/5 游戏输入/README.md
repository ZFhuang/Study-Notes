# 5 游戏输入

## 输入设备

1. 输入可以简单分为数字和模拟两大类, 数字意味着只有0和1两种状态的输入(例如普通的按键), 模拟是浮点输入(例如摇杆)
2. 游戏常常需要对同时按键和序列按键进行处理, 同时按键就是那些需要同时按下的操作, 序列按键则是很多格斗游戏中有的按键表操作. 这种处理一般可以用状态机来实现
3. 图形游戏一般都禁止系统的标准输入, 直接对输入设备进行设备级别的查询, 并维护一个数组跟踪设备对应所有按键的当前状态和上一帧状态等信息, 再利用这些信息进行状态的转换
4. 例如摇杆设备带来的模拟输入经常会有设备误差, 因此需要设置无效区域(死区), 一般通过计算设备返回的2D向量长度来进行过滤, 然后计算死区之外的向量长度与最大值之间的百分比乘上向量方向来得到过滤后的向量结果

## 输入事件系统

1. 得到输入设备的结果后游戏通常实现一个单例模式的输入管理器来管理各种输入事件, 减少事件轮询的开销
2. 一般这个输入管理器对象是全局可见的, 对象内部在每一帧对所有输入操作进行基础的处理, 而其他需要被输入调用的对象将自己的函数指针传入管理器的链表/映射表中(这种操作称为注册或绑定), 管理器在判断某输入操作发生时, 就依次调用链表中的对应函数通知需要响应事件的对象

## 移动设备输入

1. 移动设备一般面对轻度玩家, 所以最好不要采用过于复杂的操作
2. 移动设备的核心是触摸屏, 主要由模拟家用机游戏的虚拟手柄和手势操作组成
3. 一种流行的手势检测算法是Rubine算法, 其将手势线条划分出14个属性, 例如时长, 距离, 区域, 中点, 起点, 包围盒大小 等等. 绝大多数手势都可以用这套属性进行描述并判断, 响应速度也很快
4. 加速器: 检测设备轴向上的加速度, 用于甩动等玩法
5. 陀螺仪: 检测设备轴向的旋转角度, 用于瞄准等玩法
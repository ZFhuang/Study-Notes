# 11 脚本语言和数据格式

## 游戏中的脚本语言

1. 游戏中使用脚本语言是为了加快游戏逻辑开发的效率, 提高开发的灵活性
2. 需要快速迭代的部分(例如AI状态机和UI配置)应该用解释型的脚本语言快速实现和测试, 需要稳定且高效计算的部分(例如渲染和寻路算法)应该用C++等编译型的开发语言进行
3. 最好的选择方法就是从脚本语言开始开发, 直到遇到性能瓶颈和某些性能敏感的模块时再用编译语言
4. 常用的脚本语言有Lua, Python, 和例如UE4支持的可视化编程(蓝图)
5. Lua的优势是解释器非常轻量, 且非常容易与C/C++相互调用, 而且语法类似C语言方便学习

## 脚本语言的实现

1. 实现脚本解释器的原理与实现编译器类似, 整体流程大致如下
2. 标记化(词法分析): 通过正则表达式匹配之类的算法, 将代码进行扫描, 划分为大批关键词和标识符的顺序集合
3. 语法分析: 使用巴科斯范式(BNF)从划分的词语中按照定义好的语法规则生成对应的抽象语法树(AST). 语法树是一种树结构, 其叶节点是操作数, 中间节点是操作符, 可嵌套构造
4. 以后序遍历的形式遍历语法树, 将对应的每个子树的叶节点和中间节点翻译为底层开发语言进行计算, 或者作为解释型语言通过调用内置的函数来实现表达式的计算
5. 遍历语法树时, 所有运算结果保存在虚拟的栈中进行操作, 直到完全遍历完成就实现了解释

## 游戏数据的格式

1. 游戏外部数据主要有二进制文件和文本文件两种. 二进制文件用于表示携带大量信息的资源, 例如图像, 文本文件保存需要方便细节修改的资源, 例如场景配置文件
2. 二进制文件不支持版本管理, 且很难直接修改, 但文本文件过于方便编辑, 容易被玩家破解
3. 一种折中是在开发过程中使用文本文件, 直到发布的时候加入一个"烘焙"步骤, 将所有文本文件转为二进制文件压缩保存
4. 二进制文件通常没有固定格式, 将内部数据保存为二进制文件的过程称为序列化
5. INI: 最简单的文本文件, 文件内容都是键值对, 只适合简单数据, 一般用于配置文件
6. XML: 类似HTML的标记文件, 可以自定义标签和属性, 因此使用方便. 缺点是需要很多额外的字符进行控制, 可读性较差且生成的文件比较大
7. JSON: 游戏中常用的轻量级数据格式, 可读性好但生成的文件也比较大
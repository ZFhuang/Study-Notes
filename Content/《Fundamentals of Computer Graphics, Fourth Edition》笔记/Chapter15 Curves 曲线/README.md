# Chapter15 Curves 曲线

- [Chapter15 Curves 曲线](#chapter15-curves-曲线)
  - [15.1 Curves 曲线](#151-curves-曲线)
    - [15.1.1 Parameterizations and Reparameterizations 参数化与重新参数化](#1511-parameterizations-and-reparameterizations-参数化与重新参数化)
    - [15.1.2 Piecewise Parametric Representations 分段参数表示](#1512-piecewise-parametric-representations-分段参数表示)
    - [15.1.3 Splines 样条](#1513-splines-样条)
  - [15.2 Curve Properties 曲线性质](#152-curve-properties-曲线性质)
  - [15.3 多项式片段](#153-多项式片段)
    - [15.3.1 Polynomial Notation 多项式表示](#1531-polynomial-notation-多项式表示)
    - [15.3.2 A Line Segment 线段](#1532-a-line-segment-线段)
    - [15.3.3 Beyond Line Segments 超线段](#1533-beyond-line-segments-超线段)
    - [15.3.4 Basis Matrices for Cubics 三次函数基矩阵](#1534-basis-matrices-for-cubics-三次函数基矩阵)
    - [15.3.5 Blending Functions 混合函数](#1535-blending-functions-混合函数)
    - [15.3.6 Interpolating Polynomials 在多项式中插值](#1536-interpolating-polynomials-在多项式中插值)
  - [15.4 Putting Pieces Together 合并片段](#154-putting-pieces-together-合并片段)
    - [15.4.1 Knots 节点](#1541-knots-节点)
    - [15.4.2 Using Independent Pieces 使用独立片段](#1542-using-independent-pieces-使用独立片段)
    - [15.4.3 Putting Segments Together 合并片段](#1543-putting-segments-together-合并片段)
  - [15.5 Cubics 三次曲线](#155-cubics-三次曲线)

这一章介绍了曲线的表示, 内容毕竟偏向数学. 前半部分主要是介绍了曲线的性质和表示方式, 然后后半部分主要介绍了样条曲线. 样条曲线的内容在[样条曲线曲面](../../专项笔记/样条曲线曲面/README.md)有过一些简单的介绍, 这一节没有介绍曲面部分, 但是在曲线部分则进行了更加详细的介绍.

## 15.1 Curves 曲线

首先曲线是什么我们应该都很熟悉了, 在数学上曲线的定义分为两种: 离散的, 连续的. 不管是哪一种曲线都是在n维空间中的一个表示, 且都可以用一个一维参数(长度/时间)来定位. 在图形学中离散曲线比较常用. 曲线在数学上有三种表示方法:

1. 隐式曲线: 用隐式方程表示, 输入点的坐标返回是否为0表示点是否在线上.
2. ![picture 1](Media/f1b51418b2f562f9ddaf21306988a3a5d15ee3ac74f92b4e42490e56e726078e.png)  
3. 参数曲线: 输入定位曲线上点的参数(索引)到一个参数函数中, 返回对应的坐标.
4. ![picture 2](Media/6a8668e9a17502d1339396bc69c37288878ec504ecf1fd811ad72075d4568188.png) 
5. 生成式曲线:  用交并补等操作得到的曲线

图形学中常用的是参数表示的曲线, 操作起来最为自由; 隐式曲线适合表示一些固定的形状, 例如绘制圆形; 生成式曲线在表示分形的时侯比较常见. 注意参数曲线虽然常用但不代表是最简单的表示方法, 还是要具体问题具体分析. 而且显然相同的曲线也可能有多种不一样的表示, 不同的表示形式之间可以互相转化, 这一章后面着重讨论的多项式曲线就是指由多项式构成的参数曲线.

### 15.1.1 Parameterizations and Reparameterizations 参数化与重新参数化

参数曲线是指在区间上由一个参数函数映射定义的曲线, 同样的一条曲线由于参数函数设置的不同可能有不同的表示, 对应的参数区间也不同, 它们称为对一条曲线的参数化. 而将一个曲线用参数函数定义的过程称为重新参数化. 为了方便实际运算, 我们常常将曲线的参数区间重新参数化到[0,1].

参数化的好处是给了我们一种方便对比不同曲线的方法, 但是缺点是对曲线进行的参数化有时候会导致混乱, 这是因为曲线本身是不需要这个特殊参数的参与的(例如隐式曲线). 只看参数形式的话很多截然不同的曲线会有相同的参数形式, 这些曲线绘制出来的时侯形象是一样的, 但是例如在曲线内将参数写为二次幂形式, 同样参数为0.5时, 二次幂的代表的点显然与一次时代表的不同.

相同的曲线出现了不同的表达, 解决方法是给出共识让各个机器都以相同的方法选择参数, 这种为了便于定义曲线创建的参数形式称为自然参数化, 最常用的是弧长参数化, 也就是让函数沿着曲线的弧长改变, 相当于固定了函数的切线斜率.

### 15.1.2 Piecewise Parametric Representations 分段参数表示

很多曲线很难被直接用一个函数定义, 因此催生了分段参数表示, 运用分治法将曲线划分为很多阶段, 每个阶段由一个近似精确的曲线代替. 分段参数表示的曲线写出来常常就是分段函数的样子, 分段曲线最基本的要求是保持连续性, 也就是分段处需要是连接的. 然后使用分段函数的时侯需要注意分段函数是一个权衡问题, 是需要使用多密集的分段, 每一段要用多复杂的曲线来拟合, 最后需要得到怎样的结果, 一定要把握好这些权衡来得到性能和效果的平衡.

### 15.1.3 Splines 样条

样条就是以前设计师用来作为模具绘制光滑曲线的木条或金属条, 设计师用多段这种硬质又可扭曲的模具来绘制复杂的形状. 在数学上样条指的是样条函数或者说样条曲线, 它们是一系列阶数相等的分段多项式函数, 我们定义这些分段函数来表示复杂的曲线.

## 15.2 Curve Properties 曲线性质

计算机中我们很关注曲线的一些数学性质, 那些可以在曲线局部被衡量的性质, 例如导数, 称为局部性质; 那些需要全局判断的性质, 例如长度, 称为全局性质. 图形学中我们关注于下面几个局部性质, 研究这些性质的方向是微分几何:

1. 连续性
2. 位置
3. 方向
4. 曲率及其它导数

其中连续性是最常考虑的性质, 根据某点处某阶导数的不同分为不同的连续性等级, 最低的曲线相连是0阶连续, 一阶导数相同是1阶连续, 以此类推...连续性分为两种, 参数连续和几何连续: 参数连续需要曲线上各点的前后两边的对应导数相等, 用C表示, 而几何连续只需要各点两边导数相差一个固定的系数k即可, 用G表示. 图形学中几何连续性更常被考虑.

## 15.3 多项式片段

### 15.3.1 Polynomial Notation 多项式表示

分段多项式函数曲线是由很多多项式函数组成的, 多项式函数我们都很熟悉, 就形如二次方程, 三次方程等等, 将方程中的未知数项写为函数b, 分离出常数系数c, 就能写为下面的求和式子, 称为规范形式, 此时b称为基函数(base function)或混合函数(blending fuction):

![picture 1](Media/73fa79db781bd5a03edf35d09555f90485e104744cfc9419509d0619adc36d7c.png)  

规范形式的曲线便于计算机计算, 只要调整阶数n就能自动计算, 但是不方便人们理解也不容易导出. 所以这节的关键是找到几组常用的基函数b让我们能比较方便地用系数c来控制曲线.

### 15.3.2 A Line Segment 线段

最简单的多项式函数是一次的线性函数, 也就是线段. 利用线性插值我们可以在指定的两个端点(也就是系数)间进行插值, 这里的参数u就是曲线参数化得到的系数, 值从0到1, 相当于某点所在曲线上位置的百分比, 这里的p则称为控制点:

![picture 5](Media/9fb62dec03e344f985e77bd47209e29992d1617ca4d9c9e437795abca4f10025.png)  

但是这样的表示形式不同于上面提到的规范形式, 不太适合用于计算. 所以可以将相同的曲线写为规范形式如下.

![picture 6](Media/6014df35be66440d5005f24debc7e4179a7e2c454603d534fa772e38465156cc.png)  

 显然规范形式下的a与前面的p并不相同, 而且为了操作方便我们还是更喜欢通过指定端点p来定义曲线, 因此通过将上面两式联立, 代入端点处的参数, 这个多项式函数就可以写为矩阵乘法**p=f(u)=Ca**的形式如下. 此时右式左边的那个系数矩阵称为约束矩阵C, 函数的结果是真实端点位置p.

![picture 3](Media/45d905f192ba4f113f605bf89b161c2a9a020f014af95cc43974796555633dd8.png)  

又有时候我们需要在规范形式下的控制点a和真实情况下的p进行转换, 方法是求逆约束矩阵C, 得到的逆矩阵B称为基矩阵. 基矩阵让我们可以通过下面的式子方便地将p转为规范形式下的a. 下面的这个式子从矩阵展开就是对应上面的规范形式累加.

![picture 4](Media/a061972dc7f2eabfb4ecda522a816ac20bc2568f328d1c87d364b58e9be9d06b.png)  

### 15.3.3 Beyond Line Segments 超线段

仅仅是一次线段很多时侯还不能满足要求, 对而二次线段, 我们需要三个控制点来描述. 一种方法是指定曲线经过的起点u=0, 中点u=0.5, 终点u=1, 三个控制点p的位置来得到约束矩阵C. 然后求逆可以得到基矩阵B, 从而我们可以很快计算出规范的参数a并写为规范形式.

![picture 7](Media/7bec03e3b50fae5fd3b0984571df5aea2edab3dcb2d4dd979955029c7c3eadcc.png)  

另一种常用的定义则比较特别, 我们指定曲线的中点位置, 中点一阶导, 中点二阶导的值, 同样得到约束矩阵和基矩阵. 这种指定曲线某个位置的局部特征来表示曲线的方法有更高的自由度和更好的曲线效果, 在后面很常用.

![picture 8](Media/c3f53abd36cd9b9d85882c9546811c899190faa669cd085bcc2ce1736ed20109.png)  

### 15.3.4 Basis Matrices for Cubics 三次函数基矩阵

对于三次函数曲线, 我们常用的定义方式是Hermite形式, 也就是指定函数的起点位置, 起点一阶导, 终点位置, 终点一阶导. 此时推导出来的基矩阵如下. 这种函数也称为Hermite三次样条, 非常常用.

![picture 9](Media/19e7063380766d7280afff084e0e57ec89bb24186516107733aded0a09d30ebd.png)  

### 15.3.5 Blending Functions 混合函数

回顾应用基矩阵的函数, 会发现这个结构其实就是规范形式的矩阵定义. 这里的p就是系数c, 向量u是级数[1(u^0), u^1, u^2, ..., u^n]形式, 这里的uB就是基函数b, 也称为混合函数, 因为这个函数按照参数u将各个控制点混合起来得到了插值位置. 混合函数和对应的函数形式如下, 多亏了混合函数我们可以对任意曲线使用线性组合来拟合.

![picture 10](Media/a9532eec3e71662916350baa63d3db96085e482d8d8d7ab5e45d8d85d5aaac08.png)  

![picture 11](Media/160cf03b39d2d1934ff43fcf08458f2e1e3855b061d9948f14e6b8c447baa9cf.png)  

### 15.3.6 Interpolating Polynomials 在多项式中插值

通过上面求出的基矩阵, 我们可以方便插值出任何参数u所代表的曲线上的点, 但是注意到我们需要不断地进行矩阵乘法, 这个过程在高次情况下会比较慢. 下面的式子称为基函数的拉格朗日形式, 利用下面的形式我们可以用迭代的方式更快速地进行多项式曲线插值.

![picture 12](Media/55a0075c47894818ed3341ed5dcf0cb2a4df35b5da9a979bf1ad0d737a42ad18.png)  

## 15.4 Putting Pieces Together 合并片段

### 15.4.1 Knots 节点

两个不同的函数相连的点称为节点, 最常见的节点就是分段函数中两个片段相连的点. 相对于分段函数, 我们使用的多项式函数则是通过对基函数进行范围控制来达到节点的效果, 通常让范围内的基函数有值而范围外无值, 形如下式. 而整个多项式函数中所有分段函数的节点组成的向量称为节点向量.

![picture 1](Media/eb6e1620159a3a702b0bb2ccd2b4e2ad92f09e871081c44dcf0b75fa491376ee.png)  

### 15.4.2 Using Independent Pieces 使用独立片段

之前的函数定义在(0,1)范围内, 因此当我们要将多个片段整合时需要进行映射. 通常来说我们将合并的函数定义域设置为(0,n), n是片段的数量, 然后根据片段的编号进行映射.

### 15.4.3 Putting Segments Together 合并片段

片段有多种连接方式, 至少需要保证C0连续性, 也就是两个片段的头尾值是相同的. 这里以一次函数的组合来表示不同连接方式可能造成的影响. 通常的连接方式有以下三种:

1. 所有片段都用自己的两个端点来表示, 但是片段连接点必须相等, 称为共享点模式.
2. 后一个片段的头是通过复制前一个片段的尾来得到的, 称为依赖模式.
3. 直接写出连接处点的位置的定义方程.

其中共享点模式很多时候片段由两个端点决定, 由于限定了前后片段相连端点的值需要相等, 因此修改中间一个端点只会影响到相连的两个线段, 这种只会影响局部顶点的性质称为局部性, 很多时候我们希望曲线能够拥有局部性. 而依赖模式多由起点和中间点决定片段的形态, 因此一旦修改了其中某一个片段导致了后端点的改变, 就会导致后面的所有片段的起点发生改变从而连环产生影响, 这称为缺少局部性. 具体的图示可以从下图看出:

![picture 2](Media/673e35affc1a005c7535ee66ff136028e8d7ffc576048352a5c196f0b357a1fb.png)  

## 15.5 Cubics 三次曲线